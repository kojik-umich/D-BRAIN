# D-BRAINに代数的ヤコビアンは必要？
表題のとおりですが，代数的に解く必要があるのか，そもそもできるのかについての考察です．

## 代数的に解く必要があるか？
**代数微分**ではない**数値微分**に頼った際に，以下の２つが問題となる．

### 数値微分の場合の計算時間
下記の通り，**中央変分法**では計算に2倍の時間が必要となる．また，これは最適なステップサイズが事前に分かる場合の話であって，もし分からなければ **Ridders法**を使わざるを得ず，その場合10倍の時間がかかることが予想される．

| CostFunction            | 時間（ns） |
|-------------------------|------------|
| Rat43Analytic           | 255        |
| Rat43AnalyticOptimized  | 92         |
| Rat43NumericDiffForward | 262        |
| Rat43NumericDiffCentral | 517        |
| Rat43NumericDiffRidders | 3760       |

### ステップサイズどうするか問題
以下に関数
$$
f(x) = \frac{e^x}{\sin x - x^2},
$$
を使った $x=1.0$ 近傍でのベンチマークの結果がある．
![forward_central_error](picture/forward_central_error.png)

ステップサイズが小さすぎると離散化誤差の影響が出すぎてしまい，逆に大きすぎると微分と言えない領域になってしまい今度は結果精度が劣化してしまう．

ただし，軸受では弾性接近量はせいぜい 0.1~100 μm であることが予想されるので，そんなに気にしなくてもいいかもしれない？

## そもそも解けるのか？

では，軸受の接触問題で導関数（ヤコビアン）が導出できるか？についてだが，答えは Yes でもあり No でもある．
Hertz接触は綺麗な代数方程式をしているため，これ自体は微分可能である．また軸受計算では幾何学の座標変換を多く行うが，これも連鎖則を使えば簡単に計算できると思われる．
問題は摩擦理論であり，これは微分が非常に難しいことが予想される．`arctan(v)`など近似する摩擦係数ならばある程度代数微分もできるが，`v/norm(v)`と非線形操作をする場合には微分が得られない（難い）．
また，新しい摩擦理論が出るたびに，毎回微分を定義するのも確認するのも骨が折れる作業である．

## これからどうするか？
ひとまず**数値微分**で精度の様子を見る．もしとんでもなく時間がかかるようであれば，**代数ヤコビアン**の計算を検討する．
また，最初に**Ridder法**を用い，その結果を出力させ，2回目以降はその最適値を用いて**中央変分法**で計算する．
